--[[
    init.lua
    Created: 04/20/2024 22:27:43
    Description: Autogenerated script file for the map cutsceneintrobottle.
]]--
-- Commonly included lua functions and data
require 'what_does_n_stand_for.common'

-- Package name
local cutsceneintrobottle = {}

-- Local, localized strings table
-- Use this to display the named strings you added in the strings files for the map!
-- Ex:
--      local localizedstring = STRINGS.MapStrings['SomeStringName']


-------------------------------
-- Map Callbacks
-------------------------------
---cutsceneintrobottle.Init(map)
--Engine callback function
function cutsceneintrobottle.Init(map)

  --This will fill the localized strings table automatically based on the locale the game is 
  -- currently in. You can use the MapStrings table after this line!
  

end

---cutsceneintrobottle.Enter(map)
--Engine callback function
function cutsceneintrobottle.Enter(map)

StoryTime()

end

---cutsceneintrobottle.Exit(map)
--Engine callback function
function cutsceneintrobottle.Exit(map)


end

---cutsceneintrobottle.Update(map)
--Engine callback function
function cutsceneintrobottle.Update(map)


end

---cutsceneintrobottle.GameSave(map)
--Engine callback function
function cutsceneintrobottle.GameSave(map)


end

---cutsceneintrobottle.GameLoad(map)
--Engine callback function
function cutsceneintrobottle.GameLoad(map)

  GAME:FadeIn(20)

end

-------------------------------
-- Entities Callbacks
-------------------------------

function StoryTime()
local player = CH('PLAYER')
local Hoopa = CH('Hoopa')
local Bottle = OBJ('Bottle') --what / APPARENTLY IT WORKS, SO SHUT UP.

local BottleFloatLoop = false
local WaitBottleAnim = false

GAME:CutsceneMode(true)

GROUND:AddMapStatus("fog")
GAME:MoveCamera(204, 120, 1, false)
GAME:FadeIn(30)

GROUND:MoveInDirection(player, Direction.Up, 40, false, 2)

SOUND:PlayBattleSE("EVT_Emote_Confused")
GROUND:CharSetEmote(player, "question", 1)
GAME:WaitFrames(40)

UI:SetSpeaker(player)
UI:SetSpeakerEmotion("Worried")
UI:WaitShowDialogue("Huh...? [pause=0]What in the world is that thing...?")

GROUND:CharAnimateTurn(player, Direction.Right, 4, false)
GAME:WaitFrames(20)
GROUND:CharAnimateTurn(player, Direction.Left, 4, true)
GAME:WaitFrames(20)
GROUND:CharAnimateTurn(player, Direction.Up, 4, false)

GAME:WaitFrames(20)

SOUND:PlayBattleSE("EVT_Emote_Sweatdrop")
GROUND:CharSetEmote(player, "sweatdrop", 1)

GAME:WaitFrames(40)

UI:WaitShowDialogue("I don't think I can go any further...")
UI:WaitShowDialogue("Whatever's on the table doesn't look so useful either...")

GROUND:CharAnimateTurn(player, Direction.Down, 4, false)

UI:SetSpeakerEmotion("Pain")
UI:WaitShowDialogue("It's getting way too cold for me to stay here too...")
UI:WaitShowDialogue("If I don't find her soon, [pause=10]we'll both freeze...")
UI:WaitShowDialogue("I should double back to find the stairs...")

local coro1 = TASK:BranchCoroutine(function()

GROUND:MoveInDirection(player, Direction.Down, 10, false, 1)

SOUND:PlayBattleSE("EVT_Emote_Exclaim")
GROUND:CharSetEmote(player, "exclaim", 1)

end)

local coro2 = TASK:BranchCoroutine(function()

GROUND:MoveObjectToPosition(Bottle, 199, 055, 2)
GROUND:MoveObjectToPosition(Bottle, 193, 055, 2)
GROUND:MoveObjectToPosition(Bottle, 196, 055, 2)
GROUND:MoveObjectToPosition(Bottle, 199, 055, 2)
GROUND:MoveObjectToPosition(Bottle, 193, 055, 2)
GROUND:MoveObjectToPosition(Bottle, 196, 055, 2)
GROUND:MoveObjectToPosition(Bottle, 199, 055, 2)
GROUND:MoveObjectToPosition(Bottle, 193, 055, 2)
GROUND:MoveObjectToPosition(Bottle, 196, 055, 2)
GROUND:MoveObjectToPosition(Bottle, 199, 055, 2)
GROUND:MoveObjectToPosition(Bottle, 193, 055, 2)
GROUND:MoveObjectToPosition(Bottle, 196, 055, 2)

end)

--TASK:JoinCoroutines({coro1, coro2})

--GAME:WaitFrames(5)

UI:SetSpeaker(STRINGS:Format("\\uE040"), true, "", -1, "", RogueEssence.Data.Gender.Unknown)
UI:WaitShowDialogue("...help!...")

GROUND:CharAnimateTurn(player, Direction.Up, 4, true)

GAME:WaitFrames(30)

SOUND:PlayBattleSE("EVT_Emote_Confused")
GROUND:CharSetEmote(player, "question", 1)
GAME:WaitFrames(40)

GROUND:EntTurn(player, Direction.UpLeft)
SOUND:PlayBattleSE("EVT_Emote_Confused")
GAME:WaitFrames(20)
GROUND:EntTurn(player, Direction.Up)
GAME:WaitFrames(15)
SOUND:PlayBattleSE("EVT_Emote_Confused")
GROUND:EntTurn(player, Direction.UpRight)
GAME:WaitFrames(20)
GROUND:EntTurn(player, Direction.Up)
GAME:WaitFrames(30)

SOUND:PlayBattleSE("EVT_Emote_Confused")
GROUND:CharSetEmote(player, "question", 1)
GAME:WaitFrames(40)

UI:SetBounds(10,10,300,45)
UI:SetSpeakerLoc(10,65)

UI:SetSpeaker(player)
UI:SetSpeakerEmotion("Worried")
UI:WaitShowDialogue("H-hello? [pause=0]Is somebody there?")
UI:WaitShowDialogue("Where are you?")

GAME:WaitFrames(10)

UI:ResetBounds()
UI:ResetSpeakerLoc()

coro1 = TASK:BranchCoroutine(function() BottleWiggle(Bottle) end)

UI:SetSpeaker(STRINGS:Format("\\uE040"), true, "", -1, "", RogueEssence.Data.Gender.Unknown)
UI:WaitShowDialogue("...I'm stuck under this block...!")
UI:WaitShowDialogue("...It won't move...!")
UI:WaitShowDialogue("Please...! [pause=0]Help me out of here...!")

GROUND:MoveInDirection(player, Direction.Up, 50, false, 2)

GAME:WaitFrames(10)

UI:SetSpeaker(player)
UI:SetSpeakerEmotion("Determined")
UI:WaitShowDialogue("Hold on! [pause=0]I'll try to push this block out of the way!")
UI:WaitShowDialogue("Nnrf, [pause=10]stand back!")

--SOUND:LoopBattleSE("_UNK_EVT_052")
GROUND:EntTurn(player, Direction.UpLeft)
GAME:WaitFrames(10)
GROUND:CharSetAnim(player, "Charge", true)
UI:SetSpeakerEmotion("Angry")

UI:WaitShowTimedDialogue("Hnnffff...!", 60)
UI:WaitShowTimedDialogue("Come on, [pause=10]move...!", 60)

coro1 = TASK:BranchCoroutine(function()
GROUND:CharEndAnim(player)
GROUND:AnimateInDirection(player, "Walk", Direction.Up, Direction.Down, 20, 4, 2)
end)

UI:SetSpeakerEmotion("Pain")
--SOUND:StopBattleSE("_UNK_EVT_052")
UI:WaitShowDialogue("Agh...![pause=20]")
UI:WaitShowDialogue("It's no use, [pause=10]it's frozen to the ground.")

GAME:WaitFrames(20)

SOUND:PlayBattleSE("EVT_Emote_Exclaim")
GROUND:CharSetEmote(player, "exclaim", 1)

coro1 = TASK:BranchCoroutine(function() BottleWiggle(Bottle) end)

UI:SetSpeaker(STRINGS:Format("\\uE040"), true, "", -1, "", RogueEssence.Data.Gender.Unknown)
UI:WaitShowDialogue("...Slam into the block...!")
UI:WaitShowDialogue("...I think I can push it up if that ice gets weaker...")

coro1 = TASK:BranchCoroutine(function() BottleWiggle(Bottle) end)
UI:WaitShowDialogue("B-but you must hurry! [pause=0]It's getting too cold...!")

GROUND:CharSetAnim(player, "Charge", false)
GROUND:EntTurn(player, Direction.UpRight)
GAME:WaitFrames(10)

UI:SetSpeaker(player)
UI:SetSpeakerEmotion("Worried")
UI:WaitShowDialogue("I-I know it's getting way too cold to stay here...!")
UI:WaitShowDialogue("We'll just have to hurry...!")
GROUND:EntTurn(player, Direction.Up)
GAME:WaitFrames(10)
UI:SetSpeakerEmotion("Determined")
UI:WaitShowDialogue("Now stand back, [pause=10]I'm gonna hurl myself onto the block!")

coro1 = TASK:BranchCoroutine(function()
GROUND:CharSetAnim(player, "Attack", false)
GAME:WaitFrames(60)
GROUND:AnimateInDirection(player, "Walk", Direction.Up, Direction.Down, 20, 4, 2) --A way to start the animation before actually moving the char.
end)

coro2 = TASK:BranchCoroutine(function()
GAME:WaitFrames(10)
GROUND:MoveInDirection(player, Direction.Up, 12, false, 3)
GROUND:EntTurn(player, Direction.UpLeft)

SOUND:PlayBattleSE("DUN_Ice_Shard_2")
SOUND:PlayBattleSE("EVT_Tackle")
local emitter = RogueEssence.Content.SingleEmitter(RogueEssence.Content.AnimData("Ice_Fang_Hit", 3))
emitter.LocHeight = 8
GROUND:PlayVFX(emitter, 204, 083)
GROUND:MoveObjectToPosition(Bottle, 199, 055, 2)

end)

local coro3 = TASK:BranchCoroutine(function()

GAME:WaitFrames(20)

GAME:MoveCamera(200, 120, 3, false)
--GAME:WaitFrames(5)
GAME:MoveCamera(208, 120, 3, false)
--GAME:WaitFrames(5)
GAME:MoveCamera(204, 120, 3, false)

end)

TASK:JoinCoroutines({coro1, coro2, coro3})

GROUND:EntTurn(player, Direction.UpLeft)

GAME:WaitFrames(40)

UI:SetSpeakerEmotion("Pain")
UI:WaitShowDialogue("Ow, [pause=10]that hurt...")

GAME:WaitFrames(10)

GROUND:EntTurn(player, Direction.Up)
SOUND:PlayBattleSE("EVT_Emote_Exclaim")
GROUND:CharSetEmote(player, "exclaim", 1)

coro1 = TASK:BranchCoroutine(function() BottleWiggle2(Bottle) end)

UI:SetSpeaker(STRINGS:Format("\\uE040"), true, "", -1, "", RogueEssence.Data.Gender.Unknown)
UI:WaitShowDialogue("...I see a sliver of light!")
UI:WaitShowDialogue("Come on, [pause=10]just a few more hits...!")

SOUND:PlayBattleSE("EVT_Emote_Sweatdrop")
GROUND:CharSetEmote(player, "sweatdrop", 1)
GROUND:EntTurn(player, Direction.UpLeft)

GAME:WaitFrames(40)

UI:SetSpeaker(player, false)
UI:SetSpeakerEmotion("Pain")
UI:WaitShowDialogue("(There must be an easier way of doing this, [pause=10]like a button or a switch...)")
UI:WaitShowDialogue("(That would've been more convenient for whoever trapped her under there...)")
UI:SetSpeakerEmotion("Worried")
UI:WaitShowDialogue("(But something about this whole thing just seems fishy...)")
UI:WaitShowDialogue("(I just... [pause=10]can't figure out what.)")
UI:WaitShowTimedDialogue("(Maybe it's that ice-)", 10)

GAME:WaitFrames(5)

UI:SetSe("Menu/SpeakBadGuy")
UI:SetSpeaker(STRINGS:Format("\\uE040"), true, "", -1, "", RogueEssence.Data.Gender.Unknown)
GROUND:EntTurn(player, Direction.Up)
SOUND:PlayBattleSE("EVT_Emote_Startled")
GROUND:CharSetAnim(player, "Hurt", false)

coro1 = TASK:BranchCoroutine(function() BottleWiggle2ANG(Bottle) end)

UI:WaitShowTimedDialogue("What are you even waiting for?? [pause=0]Hit the-!", 10)
UI:ResetSe()
UI:WaitShowDialogue("Er... [pause=20]m-maybe hurry it up? [pause=0]It's getting real cold down here...")

SOUND:PlayBattleSE("EVT_Emote_Sweating")
GROUND:CharSetEmote(player, "sweating", 1)
GAME:WaitFrames(40)

UI:SetSpeaker(player)
UI:SetSpeakerEmotion("Surprised")
UI:WaitShowDialogue("Wh-! [pause=0]Okay okay... [pause=20]I'll hurry it up...!")
UI:SetSpeaker(player, false)
UI:SetSpeakerEmotion("Pain")
UI:WaitShowDialogue("(What was that voice I heard just now...?)")
UI:WaitShowDialogue("(That didn't sound like her...)")
UI:WaitShowDialogue("(It... [pause=20]must've been my imagination, [pause=10]yeah...)")

GROUND:EntTurn(player, Direction.UpRight)
GAME:WaitFrames(3)
GROUND:EntTurn(player, Direction.Up)
GAME:WaitFrames(3)
GROUND:EntTurn(player, Direction.UpLeft)
GAME:WaitFrames(3)
GROUND:EntTurn(player, Direction.Up)
GAME:WaitFrames(3)
GROUND:EntTurn(player, Direction.UpRight)
GAME:WaitFrames(3)
GROUND:EntTurn(player, Direction.Up)
GAME:WaitFrames(3)
GROUND:EntTurn(player, Direction.UpLeft)
GAME:WaitFrames(3)
GROUND:EntTurn(player, Direction.Up)

GAME:WaitFrames(10)

UI:SetSpeaker(player)
UI:SetSpeakerEmotion("Determined")
UI:WaitShowDialogue("I'm gonna strike it again! [pause=0]Stay back!")

coro1 = TASK:BranchCoroutine(function()
GROUND:CharSetAnim(player, "Attack", false)
GAME:WaitFrames(60)
GROUND:AnimateInDirection(player, "Walk", Direction.Up, Direction.Down, 20, 4, 2)
end)

coro2 = TASK:BranchCoroutine(function()
GAME:WaitFrames(10)
GROUND:MoveInDirection(player, Direction.Up, 14, false, 3)
GROUND:EntTurn(player, Direction.UpLeft)

SOUND:PlayBattleSE("DUN_Ice_Shard_2")
SOUND:PlayBattleSE("EVT_Tackle")
local emitter = RogueEssence.Content.SingleEmitter(RogueEssence.Content.AnimData("Ice_Fang_Hit", 3))
emitter.LocHeight = 8
GROUND:PlayVFX(emitter, 204, 083)
GROUND:MoveObjectToPosition(Bottle, 205, 055, 2)

end)

local coro3 = TASK:BranchCoroutine(function()

GAME:WaitFrames(20)

GAME:MoveCamera(200, 120, 3, false)
GAME:MoveCamera(208, 120, 3, false)
GAME:MoveCamera(204, 120, 3, false)

end)

TASK:JoinCoroutines({coro1, coro2, coro3})

GROUND:EntTurn(player, Direction.UpRight)

GAME:WaitFrames(40)

UI:SetSpeakerEmotion("Pain")
UI:WaitShowDialogue("Rrgh... [pause=20]My whole body hurts...")

coro1 = TASK:BranchCoroutine(function()
GROUND:EntTurn(player, Direction.Up)
UI:WaitShowTimedDialogue("Just one more and-", 10)
SOUND:PlayBattleSE("EVT_Emote_Shock")
GROUND:CharSetEmote(player, "shock", 1)
end)

coro2 = TASK:BranchCoroutine(function()

GAME:WaitFrames(5)
GROUND:MoveObjectToPosition(Bottle, 215, 040, 2)
GAME:WaitFrames(10)
GROUND:MoveObjectToPosition(Bottle, 215, 045, 2)

while not BottleFloatLoop do

BottleFloat(Bottle)

end

GROUND:MoveObjectToPosition(Bottle, 215, 040, 3)
WaitBottleAnim = true
GAME:WaitFrames(3)
GROUND:MoveObjectToPosition(Bottle, 196, 104, 5)

end)

--TASK:JoinCoroutines({coro1, coro2})

GAME:WaitFrames(40)
SOUND:PlayBGM("Down a Dark Path.ogg", true)
UI:SetSpeakerEmotion("Surprised")
UI:WaitShowDialogue("W-what the...!? [pause=0]The bottle's floating...!?")

GAME:WaitFrames(10)

UI:SetSpeaker(STRINGS:Format("\\uE040"), true, "", -1, "", RogueEssence.Data.Gender.Unknown)
UI:SetSe("Menu/SpeakBadGuy")
UI:WaitShowDialogue("Grah-hah-hah-hah!")
UI:WaitShowDialogue("Surprised yet? [pause=0]You're nothing more than a fool!")

GROUND:CharSetEmote(player, "angry", 0)
GROUND:CharSetAnim(player, "Sound", false)
SOUND:PlayBattleSE("EVT_Emote_Complain_2")
GAME:WaitFrames(10)

UI:ResetSe()
UI:SetSpeaker(player)
UI:SetSpeakerEmotion("Angry")
UI:WaitShowDialogue("Shut your mouth!")
UI:WaitShowDialogue("You're just a dumb glass bottle! [pause=0]Now get out of my way before I shatter you!")

GAME:WaitFrames(10)

UI:SetSpeaker(STRINGS:Format("\\uE040"), true, "", -1, "", RogueEssence.Data.Gender.Unknown)
UI:SetSe("Menu/SpeakBadGuy")
UI:WaitShowDialogue("Oh please, [pause=10]I should reward you for doing such an excellent job...")
UI:WaitShowDialogue("Thanks to you breaking the [color=#32a852]Never-Melt Ice[color] that held my little prison...")
UI:WaitShowDialogue("You'll be first to witness my true form!")
--UI:WaitShowTimedDialogue("Grah-hah-hah-hah!", 20)

UI:ResetSe()
BottleFloatLoop = true

while not WaitBottleAnim do
GAME:WaitFrames(5) --Just wait until anim finishes
end

coro1 = TASK:BranchCoroutine(function() --Someone's going to have so many questions about this. For the record, it works as intended.

GROUND:CharSetEmote(player, "shock", 1)
GAME:WaitFrames(7)
GROUND:AnimateInDirection(player, "Walk", Direction.Up, Direction.Down, 10, 4, 2)

end)

--TASK:JoinCoroutines({coro1, coro3})

SOUND:PlayBattleSE("EVT_Emote_Shock")
GAME:WaitFrames(5)
SOUND:PlayBattleSE("DUN_Octazooka")
GAME:WaitFrames(15)

SOUND:PlayBattleSE("DUN_Ice_Shard")
SOUND:PlaySE("PR_Transition_Edited")

SOUND:PlayBGM("None", true, 10)
GAME:MoveCamera(0, -028, 1, true)
GAME:FadeOut(true, 10)

UI:SetSpeaker(player)
UI:SetSpeakerEmotion("Shouting")
UI:WaitShowTimedDialogue("Waaaahhhh!!!", 60)

GROUND:Unhide("Hoopa")
GROUND:Hide("Bottle")
GROUND:EntTurn(player, Direction.UpRight)
GROUND:CharSetAnim(Hoopa, "Idle", true)
GAME:WaitFrames(60)

GAME:FadeIn(60)

GAME:WaitFrames(10)

UI:SetSpeaker(player)
UI:SetSpeakerEmotion("Pain")
UI:WaitShowDialogue("Nnf...")

GROUND:EntTurn(player, Direction.Up)
SOUND:PlayBattleSE("EVT_Emote_Shock")
GROUND:CharSetEmote(player, "shock", 1)
GAME:WaitFrames(40)

SOUND:PlayBGM("The Bittercold.ogg", true, 60)

UI:SetSpeakerEmotion("Surprised")
UI:WaitShowDialogue("...!")
UI:WaitShowDialogue("Wh-What kind of Pok√©mon a-are you?!")

GAME:WaitFrames(10)

UI:SetSe("Menu/SpeakBadGuy")
UI:SetSpeaker(STRINGS:Format("\\uE040"), true, Hoopa.CurrentForm.Species, Hoopa.CurrentForm.Form, Hoopa.CurrentForm.Skin, Hoopa.CurrentForm.Gender)
UI:SetSpeakerEmotion("Normal")
UI:WaitShowDialogue("Hmph, [pause=10]do you take me for a fool?")

coro1 = TASK:BranchCoroutine(function()
GROUND:MoveInDirection(Hoopa, Direction.Down, 15, false, 2)
end)

coro2 = TASK:BranchCoroutine(function()
GROUND:AnimateInDirection(player, "Walk", Direction.Up, Direction.Down, 15, 4, 2)
end)

TASK:JoinCoroutines({coro1, coro2})

GROUND:CharSetAnim(Hoopa, "Idle", true)

UI:WaitShowDialogue("Or are you really so oblivious to what you have just unleashed?")

GAME:WaitFrames(10)
GROUND:CharSetEmote(player, "angry", 0)

UI:ResetSe()
UI:SetSpeaker(player)
UI:SetSpeakerEmotion("Angry")
UI:WaitShowDialogue("Grr...! [pause=0]The nerve of you...!")
UI:WaitShowDialogue("What makes you think I'm gonna just let you leave this place!?")

coro1 = TASK:BranchCoroutine(function()
GROUND:MoveInDirection(Hoopa, Direction.Down, 15, false, 2)
end)

coro2 = TASK:BranchCoroutine(function()
GROUND:AnimateInDirection(player, "Walk", Direction.Up, Direction.Down, 15, 4, 2)
end)

TASK:JoinCoroutines({coro1, coro2})

GROUND:CharSetAnim(Hoopa, "Idle", true)

UI:SetSe("Menu/SpeakBadGuy")
UI:SetSpeaker(STRINGS:Format("\\uE040"), true, Hoopa.CurrentForm.Species, Hoopa.CurrentForm.Form, Hoopa.CurrentForm.Skin, Hoopa.CurrentForm.Gender)
UI:SetSpeakerEmotion("Shouting")
UI:WaitShowDialogue("Oh please, [pause=10]do try to fight me.")
UI:SetSpeakerEmotion("Normal")
UI:WaitShowDialogue("But you're just another problem I won't let slip through.")

coro1 = TASK:BranchCoroutine(function()
GROUND:MoveInDirection(Hoopa, Direction.Down, 15, false, 2)
end)

coro2 = TASK:BranchCoroutine(function()
GROUND:AnimateInDirection(player, "Walk", Direction.Up, Direction.Down, 15, 4, 2)
end)

TASK:JoinCoroutines({coro1, coro2})

GROUND:CharSetAnim(Hoopa, "Idle", true)

UI:SetSpeakerEmotion("Determined")
UI:WaitShowDialogue("Disposing you would make my job so much easier...")
UI:WaitShowDialogue("Lies and deceit are what make this world, [pause=10]not trust and honesty.")
UI:SetSpeakerEmotion("Angry")
UI:WaitShowDialogue("Now get lost!")

    local center = GAME:GetCameraCenter()
    SOUND:FadeOutBGM(20)
    local emitter = RogueEssence.Content.FlashEmitter()
    emitter.FadeInTime = 2
    emitter.HoldTime = 2
    emitter.FadeOutTime = 2
    emitter.StartColor = Color(0, 0, 0, 0)
    emitter.Layer = DrawLayer.Top
    emitter.Anim = RogueEssence.Content.BGAnimData("White", 0)
    GROUND:PlayVFX(emitter, center.X, center.Y)
    SOUND:PlayBattleSE("EVT_Battle_Flash")
    GAME:WaitFrames(30)
    GROUND:PlayVFX(emitter, center.X, center.Y)
    SOUND:PlayBattleSE("EVT_Battle_Flash")
	
	coro1 = TASK:BranchCoroutine(function()
	GAME:WaitFrames(25)
	GROUND:CharSetAnim(Hoopa, "Swing", false)
	end)
	
	coro2 = TASK:BranchCoroutine(function()
	GAME:WaitFrames(15)
	GROUND:CharSetAnim(player, "Attack", false)
	end)
	
	coro3 = TASK:BranchCoroutine(function()
	
	GAME:WaitFrames(30)
	
	SOUND:PlayBattleSE("EVT_Battle_Flash")
	GAME:FadeOut(true, 5)
	GROUND:RemoveMapStatus("fog")
	GAME:MoveCamera(-200, 240, 1, false)
    GAME:WaitFrames(120)
	GAME:FadeIn(60)
	
	SOUND:PlayBattleSE("EVT_CH05_Hot_Spring_Splash")
	
	end)
	
	TASK:JoinCoroutines({coro1, coro2. coro3})
	
	GAME:WaitFrames(200)
	
	UI:ResetSpeaker()
	UI:WaitShowDialogue("Unfortunately, [pause=10][color=#00FFFF]Hoopa[color] was too strong...")
	UI:WaitShowDialogue("In a single attack, [pause=10]".. CH('PLAYER'):GetDisplayName() .." was knocked out, [pause=10]and sent flying into the cold waters of the dungeon...")
	UI:WaitShowDialogue("...where ".. COMMON.GenderCheck(player, "they", false) .." would drift unconscious from the attack with frostbite nibbling away...")
	UI:WaitShowDialogue("...")
	UI:WaitShowDialogue(CH('PLAYER'):GetDisplayName() .." did manage to get the help ".. COMMON.GenderCheck(player, "they", false) .." needed...")
	UI:WaitShowDialogue(COMMON.GenderCheck(player, "they were", true) .." then taken to a far off village, [pause=10]away from the arctic area for healing and rest.")
	
	GAME:WaitFrames(60)
	GAME:FadeOut(false, 1)

GAME:CutsceneMode(false)

GAME:EnterGroundMap("caretakerhomecs", "Entrance")

end

function BottleWiggle(obj) --just in case

GROUND:MoveObjectToPosition(obj, 199, 055, 2)
GROUND:MoveObjectToPosition(obj, 193, 055, 2)
GROUND:MoveObjectToPosition(obj, 196, 055, 2)
GROUND:MoveObjectToPosition(obj, 199, 055, 2)
GROUND:MoveObjectToPosition(obj, 193, 055, 2)
GROUND:MoveObjectToPosition(obj, 196, 055, 2)
GROUND:MoveObjectToPosition(obj, 199, 055, 2)
GROUND:MoveObjectToPosition(obj, 193, 055, 2)
GROUND:MoveObjectToPosition(obj, 196, 055, 2)
GROUND:MoveObjectToPosition(obj, 199, 055, 2)
GROUND:MoveObjectToPosition(obj, 193, 055, 2)
GROUND:MoveObjectToPosition(obj, 196, 055, 2)

end

function BottleWiggle2(obj) --just in case

GROUND:MoveObjectToPosition(obj, 202, 055, 2)
GROUND:MoveObjectToPosition(obj, 196, 055, 2)
GROUND:MoveObjectToPosition(obj, 199, 055, 2)
GROUND:MoveObjectToPosition(obj, 202, 055, 2)
GROUND:MoveObjectToPosition(obj, 196, 055, 2)
GROUND:MoveObjectToPosition(obj, 199, 055, 2)
GROUND:MoveObjectToPosition(obj, 202, 055, 2)
GROUND:MoveObjectToPosition(obj, 196, 055, 2)
GROUND:MoveObjectToPosition(obj, 199, 055, 2)
GROUND:MoveObjectToPosition(obj, 202, 055, 2)
GROUND:MoveObjectToPosition(obj, 196, 055, 2)
GROUND:MoveObjectToPosition(obj, 199, 055, 2)

end

function BottleWiggle2ANG(obj) --just in case

GROUND:MoveObjectToPosition(obj, 202, 055, 4)
GROUND:MoveObjectToPosition(obj, 196, 055, 4)
GROUND:MoveObjectToPosition(obj, 199, 055, 4)
GROUND:MoveObjectToPosition(obj, 202, 055, 4)
GROUND:MoveObjectToPosition(obj, 196, 055, 4)
GROUND:MoveObjectToPosition(obj, 199, 055, 4)
GROUND:MoveObjectToPosition(obj, 202, 055, 4)
GROUND:MoveObjectToPosition(obj, 196, 055, 4)
GROUND:MoveObjectToPosition(obj, 199, 055, 4)
GROUND:MoveObjectToPosition(obj, 202, 055, 4)
GROUND:MoveObjectToPosition(obj, 196, 055, 4)
GROUND:MoveObjectToPosition(obj, 199, 055, 4)

end

function BottleWiggle3(obj) --just in case

GROUND:MoveObjectToPosition(obj, 199, 055, 2)
GROUND:MoveObjectToPosition(obj, 202, 055, 2)
GROUND:MoveObjectToPosition(obj, 208, 055, 2)
GROUND:MoveObjectToPosition(obj, 199, 055, 2)
GROUND:MoveObjectToPosition(obj, 202, 055, 2)
GROUND:MoveObjectToPosition(obj, 208, 055, 2)
GROUND:MoveObjectToPosition(obj, 199, 055, 2)
GROUND:MoveObjectToPosition(obj, 202, 055, 2)
GROUND:MoveObjectToPosition(obj, 208, 055, 2)
GROUND:MoveObjectToPosition(obj, 199, 055, 2)
GROUND:MoveObjectToPosition(obj, 202, 055, 2)
GROUND:MoveObjectToPosition(obj, 208, 055, 2)
GROUND:MoveObjectToPosition(obj, 205, 055, 2)

end

function BottleFloat(obj) --How else would you animate a bottle slowly?

--GROUND:MoveObjectToPosition(Bottle, 215, 068, 1)
GROUND:MoveObjectToPosition(obj, 215, 046, 1)
GAME:WaitFrames(1)
GROUND:MoveObjectToPosition(obj, 215, 045, 1)
GAME:WaitFrames(1)
GROUND:MoveObjectToPosition(obj, 215, 044, 1)
GAME:WaitFrames(1)
GROUND:MoveObjectToPosition(obj, 215, 043, 1)
GAME:WaitFrames(2)
GROUND:MoveObjectToPosition(obj, 215, 042, 1)
GAME:WaitFrames(3)
GROUND:MoveObjectToPosition(obj, 215, 041, 1)
GAME:WaitFrames(4)
GROUND:MoveObjectToPosition(obj, 215, 040, 1)
GAME:WaitFrames(4)
GROUND:MoveObjectToPosition(obj, 215, 041, 1)
GAME:WaitFrames(3)
GROUND:MoveObjectToPosition(obj, 215, 042, 1)
GAME:WaitFrames(2)
GROUND:MoveObjectToPosition(obj, 215, 043, 1)
GAME:WaitFrames(1)
GROUND:MoveObjectToPosition(obj, 215, 044, 1)
GAME:WaitFrames(1)
GROUND:MoveObjectToPosition(obj, 215, 045, 1)
GAME:WaitFrames(1)
GROUND:MoveObjectToPosition(obj, 215, 046, 1)
GAME:WaitFrames(1)
GROUND:MoveObjectToPosition(obj, 215, 047, 1)
GAME:WaitFrames(2)
GROUND:MoveObjectToPosition(obj, 215, 048, 1)
GAME:WaitFrames(3)
GROUND:MoveObjectToPosition(obj, 215, 049, 1)
GAME:WaitFrames(4)
GROUND:MoveObjectToPosition(obj, 215, 050, 1)
GAME:WaitFrames(4)
GROUND:MoveObjectToPosition(obj, 215, 049, 1)
GAME:WaitFrames(3)
GROUND:MoveObjectToPosition(obj, 215, 048, 1)
GAME:WaitFrames(2)
GROUND:MoveObjectToPosition(obj, 215, 047, 1)
GAME:WaitFrames(1)

end

return cutsceneintrobottle

