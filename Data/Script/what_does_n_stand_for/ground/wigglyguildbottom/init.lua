--[[
    init.lua
    Created: 06/11/2023 23:16:33
    Description: Autogenerated script file for the map wigglyguildbottom.
]]--
-- Commonly included lua functions and data
require 'what_does_n_stand_for.common'

-- Package name
local wigglyguildbottom = {} --This entire script was completely screwed, Palika had to clean it up to get rid of a few problems.

-- Local, localized strings table
-- Use this to display the named strings you added in the strings files for the map!
-- Ex:
--      local localizedstring = STRINGS.MapStrings['SomeStringName']


-------------------------------
-- Map Callbacks
-------------------------------
---wigglyguildbottom.Init(map)
--Engine callback function
function wigglyguildbottom.Init(map)

  --This will fill the localized strings table automatically based on the locale the game is 
  -- currently in. You can use the MapStrings table after this line!
  

end

---wigglyguildbottom.Enter(map)
--Engine callback function
function wigglyguildbottom.Enter(map)

GROUND:Hide("AdamMudkip")
GROUND:Hide("Piks")
	
if SV.dungeons.mossyoutcroppings and SV.dungeons.seasideserenade and SV.dungeons.cacklingquarry and not SV.chapter1.meeting_partA then
GAME:MoveCamera(420, 248, 1, false)
GAME:CutsceneMode(true)
GAME:FadeIn(20)
wigglyguildbottom.meetup()
end

  if SV.repeatable.daily_chant then --it should hide these before fading in.
  
  GROUND:Hide("Chimecho")
  GROUND:Hide("Bidoof")
  GROUND:Hide("Crawdaunt")
  GROUND:Hide("Sunflora")
  GROUND:Hide("CroagunkDupe")
  GROUND:Hide("LoudredDupe")
  GROUND:Hide("Wigglytuff")
  GROUND:Hide("Diglett")
  GROUND:Hide("Dugtrio")

  elseif not SV.repeatable.daily_chant then --move camera, fade in, play scene.
  
  GAME:MoveCamera(420, 248, 1, false)
  GAME:CutsceneMode(true)
  GAME:FadeIn(20)
  wigglyguildbottom.DailyChant() --reset when PC leaves through Dungeonway road.
  
  end

	if SV.chapter.number == 1 then
		if not SV.chapter1.chatot_quest1 then --too many 1's, we might need some 0's.
			wigglyguildbottom.chatot_quest1(first)
		end

	elseif SV.chapter.number == 2 then
		if not SV.chapter2.chatot_reminder then --too many 1's, we might need some 0's.
			wigglyguildbottom.chatot_quest2()
		end
	end

if not SV.chapter1.sbfadein then
  GAME:FadeIn(20) --Really stupid way of hiding the fade in, but it's better than nothing. It will continue reading until this function is over.
end

end

---wigglyguildbottom.Exit(map)
--Engine callback function
function wigglyguildbottom.Exit(map)


end

---wigglyguildbottom.Update(map)
--Engine callback function
function wigglyguildbottom.Update(map)


end

---wigglyguildbottom.GameSave(map)
--Engine callback function
function wigglyguildbottom.GameSave(map)


end

---wigglyguildbottom.GameLoad(map)
--Engine callback function
function wigglyguildbottom.GameLoad(map)

  GAME:FadeIn(20)

end

-------------------------------
-- Entities Callbacks
-------------------------------

function wigglyguildbottom.Chatot_Action(chara, activator)
local player =CH('PLAYER')

GROUND:CharTurnToChar(chara, player)

UI:SetSpeaker(chara)
UI:SetSpeakerEmotion("Normal")
	if SV.chapter.number == 1 and SV.chapter1.meeting_partA then
UI:WaitShowDialogue("Remember, [pause=10]Team [color=#ffb5fd]Electrater[color] is going to give you another assignment.")
UI:WaitShowDialogue("Be on your best behaviour now.") --I can't write chatot good.
	else
UI:WaitShowDialogue("Go along now, [pause=10]you have a long day ahead of you.")
	end
end

function wigglyguildbottom.SwapShop_Action(obj, activator)
local player =CH('PLAYER')
local Croagunk =CH('Croagunk')

UI:SetSpeaker(Croagunk)
UI:SetSpeakerEmotion("Normal")
	if SV.chapter.number <= 1 then
UI:WaitShowDialogue("Ehh... [pause=20]You're the new kid, [pause=10]yeah?")
UI:WaitShowDialogue("Don't look like much to me, [pause=10]sorry. [pause=0]I'm not sure if someone like you has anything useful to me.")
UI:WaitShowDialogue("Do your dungeon work, [pause=10]then I'll reconsider letting you know how this whole Swap Shop works.") --Open up on Chapter 2, boxes will appear in the new dungeons by then.
	else
UI:WaitShowDialogue("...Uh, [pause=10]I misplaced my lines. [pause=0]The Swap Shop ain't open, [pause=10]by the way.")
	end

end

function wigglyguildbottom.Loudred_Action(chara, activator)
local player =CH('PLAYER')

GROUND:CharTurnToChar(chara, player)

UI:SetSpeaker(chara)
UI:SetSpeakerEmotion("Normal")

if SV.chapter.number == 1 and SV.chapter1.meeting_partA then

UI:WaitShowDialogue("HOW IN THE WORLD IS EVERY DUNGEON CHANGING!?")
UI:WaitShowDialogue("IS IT BECAUSE I'M TOO GOOD AT MY JOB?")

else

UI:WaitShowDialogue("WHO ARE YOU?! [pause=0]A NEW APPRENTICE?!")
UI:WaitShowDialogue("IN THAT CASE, [pause=10]LET ME TELL YOU ABOUT EVERYTHING HERE!")

GAME:WaitFrames(10)

UI:SetSpeaker(player)
UI:SetSpeakerEmotion("Stunned")
UI:WaitShowDialogue("(I think I should run before he gives me an earful...)")

end

GROUND:EntTurn(chara, Direction.DownLeft)
end

function wigglyguildbottom.LeftSign_Action(obj, activator)
  UI:ResetSpeaker()
  UI:SetCenter(true)
  UI:SetAutoFinish(true)
  
  UI:WaitShowDialogue("<-- Mess Hall")
  
  UI:SetCenter(false)
  UI:SetAutoFinish(false)
end

function wigglyguildbottom.RightSign_Action(obj, activator)
  UI:ResetSpeaker()
  UI:SetCenter(true)
  UI:SetAutoFinish(true)
  
  UI:WaitShowDialogue("Apprentice Bedrooms -->")
  
  UI:SetCenter(false)
  UI:SetAutoFinish(false)
end

function wigglyguildbottom.LeaveGuild_Touch(obj, activator)
GAME:FadeOut(false, 20)
GAME:EnterGroundMap("wigglyguildmiddle", "Entrance2")
end

function wigglyguildbottom.EnterMesshall_Touch(obj, activator)

GAME:FadeOut(false, 20)
GAME:EnterGroundMap("wigglyguildmess", "Entrance")

end

function wigglyguildbottom.EnterBedhall_Touch(obj, activator)

GAME:FadeOut(false, 20)
GAME:EnterGroundMap("wigglyguildbedhalls", "Entrance")

end

function wigglyguildbottom.EnterGMRoom_Touch(obj, activator)
GAME:FadeOut(false, 20)
GAME:EnterGroundMap("wigglyguildmaster", "Entrance")
end

function wigglyguildbottom.DailyChant()
local player = CH('player')
local CroagunkDupe = CH('CroagunkDupe')
local Sunflora = CH('Sunflora')
local Chimecho = CH('Chimecho')
local Bidoof = CH('Bidoof')
local Diglett = CH('Diglett')
local Dugtrio = CH('Dugtrio')
local Chatot = CH('Chatot')
local Wigglytuff = CH('Wigglytuff')
local LoudredDupe = CH('LoudredDupe')
local Crawdaunt = CH('Crawdaunt') --This is an absurd number of Local calls just to animate one scene, and 2 of them don't even do anything.

--GROUND:CharSetAction(Chimecho, RogueEssence.Ground.PoseGroundAction(Chimecho.Position, Chimecho.Direction, RogueEssence.Content.GraphicsManager.GetAnimIndex("Pose")))
--GROUND:CharSetAction(Bidoof, RogueEssence.Ground.PoseGroundAction(Bidoof.Position, Bidoof.Direction, RogueEssence.Content.GraphicsManager.GetAnimIndex("Pose")))
--GROUND:CharSetAction(LoudredDupe, RogueEssence.Ground.PoseGroundAction(LoudredDupe.Position, LoudredDupe.Direction, RogueEssence.Content.GraphicsManager.GetAnimIndex("Pose")))
--GROUND:CharSetAction(Sunflora, RogueEssence.Ground.PoseGroundAction(Sunflora.Position, Sunflora.Direction, RogueEssence.Content.GraphicsManager.GetAnimIndex("Pose")))
GROUND:CharSetEmote(Dugtrio, "happy", 0)
GROUND:CharSetEmote(Sunflora, "happy", 0)
GROUND:CharSetEmote(Crawdaunt, "happy", 0)
GROUND:CharSetEmote(Chimecho, "happy", 0)

UI:SetSpeaker('[color=#00FFFF]Everyone[color]', true, "", -1, "", RogueEssence.Data.Gender.Unknown)
UI:WaitShowDialogue(STRINGS:Format(STRINGS.MapStrings['Smilesgoformiles']))

GROUND:CharSetEmote(Chimecho, "", 0)
GROUND:CharSetEmote(Bidoof, "", 0)
GROUND:CharSetEmote(LoudredDupe, "", 0)
GROUND:CharSetEmote(Sunflora, "", 0)
GROUND:CharSetEmote(Crawdaunt, "", 0)
GROUND:CharSetEmote(Dugtrio, "", 0)
GROUND:CharEndAnim(Chimecho)
GROUND:CharEndAnim(Bidoof)
GROUND:CharEndAnim(LoudredDupe)
GROUND:CharEndAnim(Sunflora)


GAME:WaitFrames(10)
UI:SetSpeaker(Chatot)
UI:SetSpeakerLoc(215,50)
UI:SetSpeakerEmotion("Normal", true)
UI:WaitShowDialogue(STRINGS:Format(STRINGS.MapStrings['Chatotwords']))
GAME:WaitFrames(5)


GROUND:CharSetAction(Chimecho, RogueEssence.Ground.PoseGroundAction(Chimecho.Position, Chimecho.Direction, RogueEssence.Content.GraphicsManager.GetAnimIndex("Pose")))
GROUND:CharSetAction(Bidoof, RogueEssence.Ground.PoseGroundAction(Bidoof.Position, Bidoof.Direction, RogueEssence.Content.GraphicsManager.GetAnimIndex("Pose")))
GROUND:CharSetAction(LoudredDupe, RogueEssence.Ground.PoseGroundAction(LoudredDupe.Position, LoudredDupe.Direction, RogueEssence.Content.GraphicsManager.GetAnimIndex("Pose")))
GROUND:CharSetAction(Sunflora, RogueEssence.Ground.PoseGroundAction(Sunflora.Position, Sunflora.Direction, RogueEssence.Content.GraphicsManager.GetAnimIndex("Pose")))
GROUND:CharSetEmote(Dugtrio, "happy", 0)
GROUND:CharSetEmote(Sunflora, "happy", 0)
GROUND:CharSetEmote(Crawdaunt, "happy", 0)
GROUND:CharSetEmote(Bidoof, "happy", 0)
GROUND:CharSetEmote(Chimecho, "happy", 0)


UI:SetSpeaker('[color=#00FFFF]Everyone[color]', true, "", -1, "", RogueEssence.Data.Gender.Unknown)
UI:WaitShowDialogue(STRINGS:Format(STRINGS.MapStrings['RalseiDeltarune'])) --Seriously, don't even ask lol

GAME:MoveCamera(0, 0, 30, true)
GROUND:CharSetEmote(Chimecho, "", 0)
GROUND:CharSetEmote(Bidoof, "", 0)
GROUND:CharSetEmote(LoudredDupe, "", 0)
GROUND:CharSetEmote(Sunflora, "", 0)
GROUND:CharSetEmote(Crawdaunt, "", 0)
GROUND:CharSetEmote(Dugtrio, "", 0)
GROUND:CharEndAnim(Chimecho)
GROUND:CharEndAnim(Bidoof)
GROUND:CharEndAnim(LoudredDupe)
GROUND:CharEndAnim(Sunflora)


--GROUND:CharWaitAnim(Dugtrio, "DigOut")
GROUND:CharSetAction(Dugtrio, RogueEssence.Ground.PoseGroundAction(Dugtrio.Position, Dugtrio.Direction, RogueEssence.Content.GraphicsManager.GetAnimIndex("DigOut")))
GAME:WaitFrames(27)
GROUND:Hide("Dugtrio")
--GROUND:CharWaitAnim(Diglett, "DigOut")
GROUND:CharSetAction(Diglett, RogueEssence.Ground.PoseGroundAction(Diglett.Position, Diglett.Direction, RogueEssence.Content.GraphicsManager.GetAnimIndex("DigOut")))
GAME:WaitFrames(27)
GROUND:Hide("Diglett")

--They leave
local coro1 = TASK:BranchCoroutine(function() wigglyguildbottom.MoveUp_Sequence(Chimecho) end)
local coro2 = TASK:BranchCoroutine(function() wigglyguildbottom.MoveUp_Sequence(Bidoof) end)
local coro3 = TASK:BranchCoroutine(function() wigglyguildbottom.MoveUp_Sequence(Crawdaunt) end)
local coro4 = TASK:BranchCoroutine(function() wigglyguildbottom.MoveUp_Sequence(Sunflora) end)
local coro5 = TASK:BranchCoroutine(function() wigglyguildbottom.MoveLeft_Sequence(LoudredDupe) end)
local coro6 = TASK:BranchCoroutine(function() wigglyguildbottom.MoveLeft_Sequence(CroagunkDupe) end)
local coro7 = TASK:BranchCoroutine(function() wigglyguildbottom.ScriptGMRoom_Sequence(Wigglytuff) end)

TASK:JoinCoroutines({coro1,coro2,coro3,coro4,coro5,coro6,coro7}) --Coroutine Clicker 2023

SV.repeatable.daily_chant = true --set false after leaving
UI:ResetSpeakerLoc()

GAME:CutsceneMode(false)
end

function wigglyguildbottom.Posing_Sequence(character)
	GROUND:CharSetAction(character, RogueEssence.Ground.PoseGroundAction(character.Position, character.Direction, RogueEssence.Content.GraphicsManager.GetAnimIndex("Pose")))
end

function wigglyguildbottom.PosingStop_Sequence(character)
	GROUND:CharEndAnim(character)
end

function wigglyguildbottom.HappyEmotes_Sequence(character)
	GROUND:CharSetEmote(character, "happy", 0)
end

function wigglyguildbottom.NoEmotes_Sequence(character)
	GROUND:CharSetEmote(character, "", 0)
end


function wigglyguildbottom.MoveUp_Sequence(character)
	GROUND:MoveToPosition(character, 316, 170, false, 2)
	GROUND:MoveToPosition(character, 316, 040, false, 2)
	GROUND:Hide(character.EntName)

end 

function wigglyguildbottom.MoveLeft_Sequence(character)
	GROUND:MoveToPosition(character, 210, 258, false, 2)
	GROUND:Hide(character.EntName)

end

function wigglyguildbottom.ScriptGMRoom_Sequence(character)
	GROUND:MoveInDirection(character, Direction.Up, 5, false, 2)
	GROUND:Hide(character.EntName)
end

function wigglyguildbottom.HideEveryone_Sequence(character)
	GROUND:Hide(character.EntName)
end

function wigglyguildbottom.chatot_quest1(first)
local player = CH('PLAYER')
local Chatot = CH('Chatot')

GROUND:EntTurn(Chatot, Direction.DownRight)

UI:SetSpeaker(Chatot)
UI:SetSpeakerEmotion("Normal", true)
UI:SetSpeakerLoc(185,50)
UI:WaitShowDialogue(STRINGS:Format(STRINGS.MapStrings['PlayerAttention'], player:GetDisplayName()))
UI:WaitShowDialogue("[color=#54ebaf]Adam[color] informed me last night that you should head to [color=#FFC663]Sharpedo Bluff[color].")
UI:WaitShowDialogue("He has some sort of assignment for you, [pause=10]which is excellent news.")
UI:WaitShowDialogue("Oh yes... [pause=20]if you're going to go over there, [pause=10]tell one of them that I feel much better now.")
UI:WaitShowDialogue("Now hurry along, [pause=10]you don't want to keep those two waiting.")

GROUND:EntTurn(Chatot, Direction.Down)

SV.chapter1.chatot_quest1 = true
UI:ResetSpeakerLoc()

end

function wigglyguildbottom.chatot_quest2()
local player = CH('PLAYER')
local Chatot = CH('Chatot')

GROUND:EntTurn(Chatot, Direction.DownRight)

UI:SetSpeaker(Chatot)
UI:SetSpeakerEmotion("Normal", true)
UI:SetSpeakerLoc(185,50)
UI:WaitShowDialogue(STRINGS:Format(STRINGS.MapStrings['PlayerAttention'], player:GetDisplayName()))
UI:WaitShowDialogue("I know you'd like to keep playing, but there's something I should mention.")
UI:WaitShowDialogue("There's no way to progress the story right now.")
UI:WaitShowDialogue("You must wait for the next update, as unfortunate as that sounds.")
UI:WaitShowDialogue("But you can still play the dungeons in this 'free play' state.")
UI:WaitShowDialogue("You are allowed to do Job Board missions if that pleases your fancy.")

GROUND:EntTurn(Chatot, Direction.Down)
GAME:UnlockDungeon('roadwalkpathway')

SV.chapter2.chatot_reminder = true
UI:ResetSpeakerLoc()

end

function wigglyguildbottom.meetup()
local player = CH('PLAYER')
local CroagunkDupe = CH('CroagunkDupe')
local Sunflora = CH('Sunflora')
local Chimecho = CH('Chimecho')
local Bidoof = CH('Bidoof')
local Diglett = CH('Diglett')
local Dugtrio = CH('Dugtrio')
local Chatot = CH('Chatot')
local Wigglytuff = CH('Wigglytuff')
local LoudredDupe = CH('LoudredDupe')
local Crawdaunt = CH('Crawdaunt')
local AdamMudkip = CH('AdamMudkip')
local Piks = CH('Piks') --christ.

GROUND:Unhide("AdamMudkip")
GROUND:Unhide("Piks")

GROUND:CharSetEmote(Dugtrio, "happy", 0)
GROUND:CharSetEmote(Sunflora, "happy", 0)
GROUND:CharSetEmote(Crawdaunt, "happy", 0)
GROUND:CharSetEmote(Chimecho, "happy", 0)

UI:SetSpeaker('[color=#00FFFF]Everyone[color]', true, "", -1, "", RogueEssence.Data.Gender.Unknown)
UI:WaitShowDialogue(STRINGS:Format(STRINGS.MapStrings['Smilesgoformiles']))

GROUND:CharSetEmote(Chimecho, "", 0)
GROUND:CharSetEmote(Bidoof, "", 0)
GROUND:CharSetEmote(LoudredDupe, "", 0)
GROUND:CharSetEmote(Sunflora, "", 0)
GROUND:CharSetEmote(Crawdaunt, "", 0)
GROUND:CharSetEmote(Dugtrio, "", 0)
GROUND:CharEndAnim(Chimecho)
GROUND:CharEndAnim(Bidoof)
GROUND:CharEndAnim(LoudredDupe)
GROUND:CharEndAnim(Sunflora)

GAME:WaitFrames(10)
UI:SetSpeaker(Chatot)
UI:SetSpeakerLoc(215,50)
UI:SetSpeakerEmotion("Normal", true)
UI:WaitShowDialogue(STRINGS:Format(STRINGS.MapStrings['Chatotwords']))
GAME:WaitFrames(5)

GROUND:CharSetAction(Chimecho, RogueEssence.Ground.PoseGroundAction(Chimecho.Position, Chimecho.Direction, RogueEssence.Content.GraphicsManager.GetAnimIndex("Pose")))
GROUND:CharSetAction(Bidoof, RogueEssence.Ground.PoseGroundAction(Bidoof.Position, Bidoof.Direction, RogueEssence.Content.GraphicsManager.GetAnimIndex("Pose")))
GROUND:CharSetAction(LoudredDupe, RogueEssence.Ground.PoseGroundAction(LoudredDupe.Position, LoudredDupe.Direction, RogueEssence.Content.GraphicsManager.GetAnimIndex("Pose")))
GROUND:CharSetAction(Sunflora, RogueEssence.Ground.PoseGroundAction(Sunflora.Position, Sunflora.Direction, RogueEssence.Content.GraphicsManager.GetAnimIndex("Pose")))
GROUND:CharSetEmote(Dugtrio, "happy", 0)
GROUND:CharSetEmote(Sunflora, "happy", 0)
GROUND:CharSetEmote(Crawdaunt, "happy", 0)
GROUND:CharSetEmote(Bidoof, "happy", 0)
GROUND:CharSetEmote(Chimecho, "happy", 0)

UI:SetSpeaker('[color=#00FFFF]Everyone[color]', true, "", -1, "", RogueEssence.Data.Gender.Unknown)
UI:WaitShowDialogue(STRINGS:Format(STRINGS.MapStrings['RalseiDeltarune'])) --Seriously, don't even ask lol

GROUND:CharSetEmote(Chimecho, "", 0)
GROUND:CharSetEmote(Bidoof, "", 0)
GROUND:CharSetEmote(LoudredDupe, "", 0)
GROUND:CharSetEmote(Sunflora, "", 0)
GROUND:CharSetEmote(Crawdaunt, "", 0)
GROUND:CharSetEmote(Dugtrio, "", 0)
GROUND:CharEndAnim(Chimecho)
GROUND:CharEndAnim(Bidoof)
GROUND:CharEndAnim(LoudredDupe)
GROUND:CharEndAnim(Sunflora)

GAME:WaitFrames(20)
GROUND:CharSetEmote(Dugtrio, "exclaim", 1)
GROUND:CharSetEmote(Sunflora, "exclaim", 1)
GROUND:CharSetEmote(Crawdaunt, "exclaim", 1)
GROUND:CharSetEmote(Bidoof, "exclaim", 1)
GROUND:CharSetEmote(Chimecho, "exclaim", 1)
SOUND:PlayBattleSE("EVT_Emote_Exclaim_2")

SOUND:PlayBGM("None", true)
UI:SetSpeaker(STRINGS:Format("\\uE040"), true, "", -1, "", RogueEssence.Data.Gender.Unknown)
UI:WaitShowDialogue("One second, [pause=10]please!")

local coro1 = TASK:BranchCoroutine(function() wigglyguildbottom.ladderdown_Sequence(AdamMudkip) end)
local coro2 = TASK:BranchCoroutine(function() wigglyguildbottom.ladderdown2_Sequence(Piks) end)
local coro3 = TASK:BranchCoroutine(function() wigglyguildbottom.turnupleft_Sequence(Chimecho) end)
local coro4 = TASK:BranchCoroutine(function() wigglyguildbottom.turnupleft_Sequence(Bidoof) end)
local coro5 = TASK:BranchCoroutine(function() wigglyguildbottom.turnupleft_Sequence(Crawdaunt) end)
local coro6 = TASK:BranchCoroutine(function() wigglyguildbottom.turnleftALT_Sequence(Sunflora) end)
local coro7 = TASK:BranchCoroutine(function() wigglyguildbottom.turnupleft_Sequence(LoudredDupe) end)
local coro8 = TASK:BranchCoroutine(function() wigglyguildbottom.turnupleft_Sequence(CroagunkDupe) end)
local coro9 = TASK:BranchCoroutine(function() wigglyguildbottom.turnleft_Sequence(Wigglytuff) end)
local coro10 = TASK:BranchCoroutine(function() wigglyguildbottom.turnleftALT_Sequence(Diglett) end)
local coro11 = TASK:BranchCoroutine(function() wigglyguildbottom.turnupleft_Sequence(Dugtrio) end)
local coro12 = TASK:BranchCoroutine(function() wigglyguildbottom.turnleft_Sequence(Chatot) end)
local coro13 = TASK:BranchCoroutine(function() wigglyguildbottom.turnleftALT_Sequence(player) end)

TASK:JoinCoroutines({coro1,coro2,coro3,coro4,coro5,coro6,coro7,coro8,coro9,coro10,coro11,coro12,coro13}) --Surely, they all take multiple ticks to work, and doesn't need- agh, f--- it, I dunno what I'm programming. / You and me both, me from the past.

SOUND:PlayBGM("Wigglytuff's Guild Remix.ogg", true)

UI:SetSpeaker(Piks)
UI:SetSpeakerLoc(20,40)
UI:SetSpeakerEmotion("Normal")
UI:WaitShowDialogue("Good morning, [pause=10]everyone!")

GAME:WaitFrames(10)

UI:SetSpeaker(Chatot)
UI:SetSpeakerLoc(215,50)
UI:SetSpeakerEmotion("Normal", true)
UI:WaitShowDialogue("Ah... [pause=20]good morning, [pause=10]Team [color=#ffb5fd]Electrater[color]. [pause=0]What're you two doing here?")

GROUND:EntTurn(Piks, Direction.Right)
GROUND:EntTurn(AdamMudkip, Direction.Right)
GAME:WaitFrames(10)

UI:SetSpeaker(AdamMudkip)
UI:SetSpeakerLoc(20, 50)
UI:SetSpeakerEmotion("Normal")
UI:WaitShowDialogue("We're here if anyone else has noticed any other strange things happening in the dungeons.")
UI:SetSpeakerEmotion("Worried")
UI:WaitShowDialogue("As it stands right now...")
UI:WaitShowDialogue("[color=#FFC663]Apple Woods[color], [pause=10][color=#FFC663]Serenity River[color], [pause=10][color=#FFC663]Blizzard Island[color]... [pause=20]a lot of them seemed to have strayed from the usual rules.")
UI:SetSpeaker(AdamMudkip, false)
UI:SetSpeakerEmotion("Worried")
UI:WaitShowDialogue("(Except the ones only me and [color=#54ebaf]Piks[color] have access to, [pause=10]for some reason...)")

SOUND:PlayBattleSE("EVT_Emote_Sweating")
GROUND:CharSetEmote(Bidoof, "sweating", 1)
GAME:WaitFrames(40)

UI:SetSpeaker(Bidoof)
UI:SetSpeakerLoc(264,131)
UI:SetSpeakerEmotion("Worried", true)
UI:WaitShowDialogue("Oof... [pause=20]I did notice that too...")
UI:WaitShowDialogue("[color=#FFC663]Mt. Bristle[color] had a [color=#00FFFF]Skarmory[color] in it!")

coro1 = TASK:BranchCoroutine(function()

GAME:WaitFrames(4)
GROUND:CharTurnToCharAnimated(AdamMudkip, Bidoof, 4)

end)

coro2 = TASK:BranchCoroutine(function()

GAME:WaitFrames(5)
GROUND:CharTurnToCharAnimated(Piks, Bidoof, 4)

end)

coro3 = TASK:BranchCoroutine(function()

GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(Chatot, Bidoof, 4)

end)

coro4 = TASK:BranchCoroutine(function()

GAME:WaitFrames(7)
GROUND:CharTurnToCharAnimated(Wigglytuff, Bidoof, 4)

end)

coro5 = TASK:BranchCoroutine(function()

GAME:WaitFrames(5)
GROUND:CharTurnToCharAnimated(Chimecho, Bidoof, 4)

end)

coro6 = TASK:BranchCoroutine(function()

GAME:WaitFrames(4)
GROUND:CharTurnToCharAnimated(Crawdaunt, Bidoof, 4)

end)

coro7 = TASK:BranchCoroutine(function()

GAME:WaitFrames(5)
GROUND:CharTurnToCharAnimated(Dugtrio, Bidoof, 4)

end)

coro8 = TASK:BranchCoroutine(function()

GAME:WaitFrames(3)
GROUND:CharTurnToCharAnimated(Sunflora, Bidoof, 4)

end)

coro9 = TASK:BranchCoroutine(function()
GAME:WaitFrames(7)
GROUND:CharTurnToCharAnimated(Diglett, Bidoof, 4)
end)

coro10 = TASK:BranchCoroutine(function()
GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(LoudredDupe, Bidoof, 4)
end)

coro11 = TASK:BranchCoroutine(function()

GAME:WaitFrames(4)
GROUND:CharTurnToCharAnimated(CroagunkDupe, Bidoof, 4)

end)

SOUND:PlayBattleSE("EVT_Emote_Shock_Bad")
GROUND:CharSetEmote(Sunflora, "shock", 1)
GAME:WaitFrames(20)

UI:SetSpeaker(Sunflora)
UI:SetSpeakerEmotion("Surprised", true)
UI:WaitShowDialogue("A wahh!? [pause=0]That sounds really scary, [pause=10][color=#00FFFF]Bidoof[color]!")

GROUND:CharAnimateTurn(Bidoof, Direction.Right, 4, false)
GAME:WaitFrames(10)

UI:SetSpeaker(Bidoof)
UI:ResetSpeakerLoc()
UI:SetSpeakerEmotion("Worried")
UI:WaitShowDialogue("Yep yep... [pause=20]Even the layout was unnatural...")

SOUND:PlayBattleSE("EVT_Emote_Sweatdrop")
GROUND:CharSetEmote(Crawdaunt, "sweatdrop", 1)
GAME:WaitFrames(40)

UI:SetSpeaker(Crawdaunt)
UI:SetSpeakerEmotion("Worried")
UI:WaitShowDialogue("Hey hey, [pause=10]don't forget the time I entered a dungeon that was completely flooded... [br]There is no way anyone that can't swim can get in there.")

SOUND:PlayBattleSE("EVT_Emote_Sweating")
GROUND:CharSetEmote(AdamMudkip, "sweating", 1)
GAME:WaitFrames(40)

UI:SetSpeaker(AdamMudkip)
UI:SetSpeakerLoc(20, 50)
UI:SetSpeakerEmotion("Worried")
UI:WaitShowDialogue("This might be harder to fix than I thought...")

coro1 = TASK:BranchCoroutine(function()
GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(Bidoof, AdamMudkip, 4)
end)

coro2 = TASK:BranchCoroutine(function()
GAME:WaitFrames(4)
GROUND:CharTurnToCharAnimated(Piks, AdamMudkip, 4)
end)

coro3 = TASK:BranchCoroutine(function()
GAME:WaitFrames(5)
GROUND:CharTurnToCharAnimated(Chatot, AdamMudkip, 4)
end)

coro4 = TASK:BranchCoroutine(function()
GAME:WaitFrames(4)
GROUND:CharTurnToCharAnimated(Wigglytuff, AdamMudkip, 4)
end)

coro5 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(Chimecho, AdamMudkip, 4)
end)

coro6 = TASK:BranchCoroutine(function()
GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(Crawdaunt, AdamMudkip, 4)
end)

coro7 = TASK:BranchCoroutine(function()
GAME:WaitFrames(5)
GROUND:CharTurnToCharAnimated(Dugtrio, AdamMudkip, 4)
end)

coro8 = TASK:BranchCoroutine(function()
GAME:WaitFrames(3)
GROUND:CharTurnToCharAnimated(Sunflora, AdamMudkip, 4)
end)

coro9 = TASK:BranchCoroutine(function()
GAME:WaitFrames(4)
GROUND:CharTurnToCharAnimated(Diglett, AdamMudkip, 4)
end)

coro10 = TASK:BranchCoroutine(function()
GAME:WaitFrames(7)
GROUND:CharTurnToCharAnimated(LoudredDupe, AdamMudkip, 4)
end)

coro11 = TASK:BranchCoroutine(function()
GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(CroagunkDupe, AdamMudkip, 4)
end)

GAME:WaitFrames(20)

UI:WaitShowDialogue("Dungeons that we have explored before, [pause=10]dungeons we're just finding now...")
UI:WaitShowDialogue("Something must be influencing the way these dungeons are working, [pause=10]and not in a good way.")

GAME:WaitFrames(10)

UI:SetSpeaker(Chatot)
UI:SetSpeakerLoc(215,50)
UI:SetSpeakerEmotion("Worried", true)
UI:WaitShowDialogue("Oh dear. [pause=0]Surely you two have some sort of guess, [pause=10]or starting point? [pause=0]You usually do...")

GROUND:CharSetEmote(Piks, "sweatdrop", 1)
SOUND:PlayBattleSE("EVT_Emote_Sweatdrop")
GROUND:EntTurn(AdamMudkip, Direction.Right)
GROUND:CharAnimateTurn(Piks, Direction.Right, 4, true) 
GAME:WaitFrames(40)

UI:SetSpeaker(Piks)
UI:SetSpeakerLoc(20, 40)
UI:SetSpeakerEmotion("Worried")
UI:WaitShowDialogue("Not this time, [pause=10][color=#00FFFF]Chatot[color]. [pause=0]We're trying our best to find something, [pause=10]but we're turning up empty handed.")
UI:SetSpeakerEmotion("Sad")
UI:WaitShowDialogue("The Expedition Society is helping too, [pause=10]but they haven't found anything either...")

GAME:WaitFrames(10)

coro1 = TASK:BranchCoroutine(function()
GAME:WaitFrames(5)
GROUND:CharTurnToCharAnimated(AdamMudkip, LoudredDupe, 4)
end)

coro2 = TASK:BranchCoroutine(function()
GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(Piks, LoudredDupe, 4)
end)

coro3 = TASK:BranchCoroutine(function()
GAME:WaitFrames(7)
GROUND:CharTurnToCharAnimated(Chatot, LoudredDupe, 4)
end)

coro4 = TASK:BranchCoroutine(function()
GAME:WaitFrames(5)
GROUND:CharTurnToCharAnimated(Wigglytuff, LoudredDupe, 4)
end)

coro5 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(Chimecho, LoudredDupe, 4)
end)

coro6 = TASK:BranchCoroutine(function()
GAME:WaitFrames(4)
GROUND:CharTurnToCharAnimated(Crawdaunt, LoudredDupe, 4)
end)

coro7 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(5)
GROUND:CharTurnToCharAnimated(Dugtrio, LoudredDupe, 4)
end)

coro8 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(4)
GROUND:CharTurnToCharAnimated(Sunflora, LoudredDupe, 4)
end)

coro9 = TASK:BranchCoroutine(function()
GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(Diglett, LoudredDupe, 4)
end)

coro10 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(3)
GROUND:CharTurnToCharAnimated(Bidoof, LoudredDupe, 4)
end)

coro11 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(CroagunkDupe, LoudredDupe, 4)
end)

UI:SetSpeaker(LoudredDupe)
UI:SetSpeakerLoc(264,131)
UI:SetSpeakerEmotion("Normal", true)
UI:WaitShowDialogue("WHAT ARE YOU GONNA DO NOW??")

SOUND:PlayBattleSE("EVT_Emote_Sweating")
GROUND:CharSetEmote(AdamMudkip, "sweating", 1)

GAME:WaitFrames(40)

UI:SetSpeaker(AdamMudkip)
UI:SetSpeakerLoc(20, 50)
UI:SetSpeakerEmotion("Pain")
UI:WaitShowDialogue("Without any sort of lead, [pause=10]we don't have a choice but to continue our guild work.")

coro1 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(4)
GROUND:CharTurnToCharAnimated(Bidoof, AdamMudkip, 4)
end)

coro2 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(7)
GROUND:CharTurnToCharAnimated(Piks, AdamMudkip, 4)
end)

coro3 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(Chatot, AdamMudkip, 4)
end)

coro4 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(7)
GROUND:CharTurnToCharAnimated(Wigglytuff, AdamMudkip, 4)
end)

coro5 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(5)
GROUND:CharTurnToCharAnimated(Chimecho, AdamMudkip, 4)
end)

coro6 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(4)
GROUND:CharTurnToCharAnimated(Crawdaunt, AdamMudkip, 4)
end)

coro7 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(3)
GROUND:CharTurnToCharAnimated(Dugtrio, AdamMudkip, 4)
end)

coro8 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(5)
GROUND:CharTurnToCharAnimated(Sunflora, AdamMudkip, 4)
end)

coro9 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(Diglett, AdamMudkip, 4)
end)

coro10 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(7)
GROUND:CharTurnToCharAnimated(LoudredDupe, AdamMudkip, 4)
end)

coro11 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(3)
GROUND:CharTurnToCharAnimated(CroagunkDupe, AdamMudkip, 4)
end)

UI:SetSpeakerEmotion("Worried")
UI:WaitShowDialogue("Already, [pause=10]a varying number of problems are popping up around the region.")
UI:WaitShowDialogue("Basic travel, [pause=10]store supplies, [pause=10]our guild work, [pause=10]training...")
UI:WaitShowDialogue("Pokémon are having a difficult time right now. [pause=0]They're gonna need the guild more than ever.")

GROUND:CharAnimateTurn(Wigglytuff, Direction.Left, 4, false)
GAME:WaitFrames(10)

UI:SetSpeaker(Wigglytuff)
UI:SetSpeakerLoc(175,20)
UI:SetSpeakerEmotion("Normal", true)
UI:WaitShowDialogue("You two are excellent explorers. [pause=0]I'm confident you'll search everywhere to fix it!")

coro1 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(5)
GROUND:CharTurnToCharAnimated(AdamMudkip, Wigglytuff, 4)
end)

coro2 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(Piks, Wigglytuff, 4)
end)

coro3 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(4)
GROUND:CharTurnToCharAnimated(Chatot, Wigglytuff, 4)
end)

coro4 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(Bidoof, Wigglytuff, 4)
end)

coro5 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(7)
GROUND:CharTurnToCharAnimated(Chimecho, Wigglytuff, 4)
end)

coro6 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(5)
GROUND:CharTurnToCharAnimated(Crawdaunt, Wigglytuff, 4)
end)

coro7 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(Dugtrio, Wigglytuff, 4)
end)

coro8 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(7)
GROUND:CharTurnToCharAnimated(Sunflora, Wigglytuff, 4)
end)

coro9 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(Diglett, Wigglytuff, 4)
end)

coro10 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(4)
GROUND:CharTurnToCharAnimated(LoudredDupe, Wigglytuff, 4)
end)

coro11 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(5)
GROUND:CharTurnToCharAnimated(CroagunkDupe, Wigglytuff, 4)
end)

coro12 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(player, Wigglytuff, 4)
end)

GAME:WaitFrames(10)
UI:SetSpeaker(AdamMudkip)
UI:SetSpeakerLoc(20, 50)
UI:SetSpeakerEmotion("Pain")
UI:WaitShowDialogue("I hope so, [pause=10]miss [color=#00FFFF]Wigglytuff[color].")
GROUND:EntTurn(AdamMudkip, Direction.DownRight)

coro1 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(Bidoof, AdamMudkip, 4)
end)

coro2 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(7)
GROUND:CharTurnToCharAnimated(Piks, AdamMudkip, 4)
end)

coro3 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(Chatot, AdamMudkip, 4)
end)

coro4 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(5)
GROUND:CharTurnToCharAnimated(Wigglytuff, AdamMudkip, 4)
end)

coro5 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(4)
GROUND:CharTurnToCharAnimated(Chimecho, AdamMudkip, 4)
end)

coro6 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(Crawdaunt, AdamMudkip, 4)
end)

coro7 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(5)
GROUND:CharTurnToCharAnimated(Dugtrio, AdamMudkip, 4)
end)

coro8 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(4)
GROUND:CharTurnToCharAnimated(Sunflora, AdamMudkip, 4)
end)

coro9 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(5)
GROUND:CharTurnToCharAnimated(Diglett, AdamMudkip, 4)
end)

coro10 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(6)
GROUND:CharTurnToCharAnimated(LoudredDupe, AdamMudkip, 4)
end)

coro11 = TASK:BranchCoroutine(function() 
GAME:WaitFrames(4)
GROUND:CharTurnToCharAnimated(CroagunkDupe, AdamMudkip, 4)
end)

GROUND:EntTurn(player, Direction.Left)
UI:SetSpeakerEmotion("Normal")
UI:WaitShowDialogue(STRINGS:Format(STRINGS.MapStrings['PlayerBeckon'], player:GetDisplayName()))
UI:WaitShowDialogue("Me and [color=#54ebaf]Piks[color] will have to leave early, [pause=10]so we'll see everyone later. [pause=0]Bye now!")
SOUND:PlayBGM("None", true)

coro1 = TASK:BranchCoroutine(function()
 	GROUND:MoveToPosition(AdamMudkip, 316, 170, false, 1)
	GROUND:MoveToPosition(AdamMudkip, 316, 040, false, 1)
	GROUND:Hide("AdamMudkip")
	end)
	
coro2 = TASK:BranchCoroutine(function() 
	GROUND:CharAnimateTurn(Piks, Direction.Left, 4, false)
	GAME:WaitFrames(10)
 	GROUND:MoveToPosition(Piks, 316, 170, false, 1)
	GROUND:MoveToPosition(Piks, 316, 040, false, 1)
	GROUND:Hide("Piks")
	end)
	
coro3 = TASK:BranchCoroutine(function() GAME:FadeOut(false, 30) end)

GAME:WaitFrames(60)

UI:SetSpeaker(Chatot)
UI:SetSpeakerLoc(264,131)
UI:SetSpeakerEmotion("Normal", true)
UI:WaitShowDialogue("Come on now, [pause=10]we still have work to be doing!") --Literally used to extend the time a little bit further so the two despawn.
UI:WaitShowDialogue("It's going to be a real busy week if we don't handle those jobs now!")

GAME:WaitFrames(60)

SV.repeatable.daily_chant = true
SV.chapter1.meeting_partA = true

GAME:MoveCamera(0, 0, 1, true)

  GROUND:Hide("Chimecho")
  GROUND:Hide("Bidoof")
  GROUND:Hide("Crawdaunt")
  GROUND:Hide("Sunflora")
  GROUND:Hide("CroagunkDupe")
  GROUND:Hide("LoudredDupe")
  GROUND:Hide("Wigglytuff")
  GROUND:Hide("Diglett")
  GROUND:Hide("Dugtrio")
  GROUND:EntTurn(player, Direction.Up)
  GROUND:EntTurn(Chatot, Direction.Down)
  
  GAME:FadeIn(30)
  SOUND:PlayBGM("Wigglytuff's Guild.ogg", true)
  
  UI:ResetSpeakerLoc()

GAME:CutsceneMode(false)
end

function wigglyguildbottom.ladderdown_Sequence(character)
GROUND:AnimateToPosition(character, "Walk", Dir8.Up, 317, 155, 1, 2, 0)
GROUND:MoveToPosition(character, 345, 210, false, 1)
end

function wigglyguildbottom.ladderdown2_Sequence(character)
GROUND:AnimateToPosition(character, "Walk", Dir8.Up, 317, 155, 1, 2, 0)
GROUND:MoveToPosition(character, 360, 192, false, 1)
end

function wigglyguildbottom.turnleft_Sequence(character)
GROUND:CharAnimateTurn(character, Direction.Left, 4, false)
end

function wigglyguildbottom.turnleftALT_Sequence(character)
GROUND:CharAnimateTurn(character, Direction.Left, 4, true)
end

function wigglyguildbottom.turnupleft_Sequence(character)
GROUND:CharAnimateTurn(character, Direction.UpLeft, 4, true)
end

return wigglyguildbottom

